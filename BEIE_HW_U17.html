<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- TỐI ƯU CHO ĐIỆN THOẠI -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IELTS Listening & Reading – Practice Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1100px;
      margin: 20px auto;
      padding: 0 15px;
      line-height: 1.5;
      background-color: #fff7e6;
      font-size: 16px;
    }
    h1 {
      text-align: center;
      margin-bottom: 10px;
      font-size: 26px;
    }
    h2 {
      margin-top: 10px;
      margin-bottom: 8px;
      font-size: 18px;
      border-bottom: 1px solid #ccc;
      padding-bottom: 4px;
    }
    .info {
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 10px 12px;
      margin-bottom: 12px;
      background-color: #fafafa;
      font-size: 15px;
    }
    .info input {
      padding: 6px 8px;
      font-size: 15px;
    }
    .group-block {
      border: 1px solid #eee;
      border-radius: 6px;
      padding: 10px 12px;
      margin-bottom: 15px;
      background-color: #fafafa;
    }
    .passage {
      margin: 8px 0 12px 0;
      padding: 8px 10px;
      border-left: 3px solid #007acc;
      background-color: #ffffff;
      font-size: 14px;
    }
    .question {
      margin-bottom: 12px;
      padding: 8px 8px 10px 8px;
      border-bottom: 1px dashed #ddd;
      background-color: #ffffff;
      font-size: 15px;
    }
    .question.correct {
      background-color: #e6ffe6;
    }
    .question.incorrect {
      background-color: #ffe6e6;
    }
    .question-number {
      font-weight: bold;
    }
    .btn {
      padding: 8px 14px;
      margin-right: 8px;
      border-radius: 4px;
      border: 1px solid #888;
      background-color: #f5f5f5;
      cursor: pointer;
      font-size: 15px;
    }
    .btn:hover {
      background-color: #e0e0e0;
    }
    #timer {
      font-weight: bold;
      color: #d9534f;
    }
    .result {
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 10px 12px;
      margin-top: 12px;
      background-color: #fff;
      font-size: 15px;
    }
    .short-answer-input {
      width: 80%;
      max-width: 400px;
      padding: 6px 8px;
      font-size: 15px;
    }
    audio {
      width: 100%;
      margin: 8px 0 10px 0;
    }
    iframe.audio-frame {
      width: 100%;
      height: 80px;
      border: 0;
      margin: 8px 0 10px 0;
    }
    img.q-img {
      max-width: 100%;
      height: auto;
      margin: 6px 0;
      display: block;
    }
    .img-frame {
      width: 100%;
      max-width: 100%;
      height: 260px;
      border: 0;
      margin: 6px 0;
      display: block;
    }
    .btn-row {
      width: 100%;
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .footer {
      text-align: center;
      margin-top: 40px;
      padding: 20px 0;
      color: #444;
      font-size: 14px;
      opacity: 0.85;
    }

    /* Layout hai cột cho Reading (màn hình lớn) */
    .reading-layout {
      display: flex;
      gap: 20px;
      align-items: flex-start;
      margin-bottom: 15px;
    }
    .reading-left {
      flex: 1.4;
    }
    .reading-right {
      flex: 1;
    }

    /* ====== TỐI ƯU CHO MOBILE ====== */
    @media (max-width: 768px) {
      body {
        max-width: 100%;
        margin: 0;
        padding: 10px 8px 30px 8px;
        font-size: 16px;
      }
      h1 {
        font-size: 22px;
        margin-top: 10px;
      }
      .info {
        padding: 10px;
      }
      .info label {
        display: block;
        margin-bottom: 6px;
      }
      .info input {
        width: 100%;
        box-sizing: border-box;
        margin-top: 4px;
      }
      .reading-layout {
        flex-direction: column; /* passage trên – câu hỏi dưới */
      }
      .reading-left,
      .reading-right {
        width: 100%;
      }
      .group-block {
        padding: 10px 10px;
      }
      .passage {
        font-size: 15px;
      }
      .question {
        font-size: 15px;
      }
      .short-answer-input {
        width: 100%;
        max-width: 100%;
      }
      .btn-row {
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
      }
      .btn-row .btn {
        width: 100%;
        font-size: 16px;
        padding: 10px 0;
      }
    }
  </style>
</head>
<body>
 <h1 id="pageTitle">Đang tải tiêu đề...</h1>

  <div class="info">
    <p><strong>Thời gian làm bài còn lại:</strong> <span id="timer">--:--</span></p>
    <p>Làm xong hãy bấm <strong>Nộp bài</strong> để xem điểm. Có thể tải lại trang để làm lại.</p>
    <p>
      <label>Họ tên học viên:
        <input type="text" id="studentName" placeholder="Nguyễn Văn A">
      </label>
    </p>
    <p>
      <label>Lớp / Nhóm:
        <input type="text" id="studentClass" placeholder="VD: 8A, TOEIC-Reading 1">
      </label>
    </p>
  </div>

  <div id="quiz"></div>

  <div class="btn-row">
    <button class="btn" id="submitBtn">Nộp bài & xem kết quả</button>
    <button class="btn" id="retryBtn">Làm lại từ đầu</button>
  </div>

  <div class="result" id="resultBox" style="display:none;"></div>

<script>
// ====== CẤU HÌNH CHO GIÁO VIÊN ======
const DURATION_MINUTES = 40;

// Lấy TEST_ID từ tên file hiện tại, ví dụ "BEIE_HW_U6.html"
const fileSegment = location.pathname.split('/').pop() || '';
const TEST_ID = decodeURIComponent(
  fileSegment.replace(/\.[^/.]+$/, '')
) || 'PracticeTest';

// Cập nhật tiêu đề trang và H1 ngay khi tải
document.title = TEST_ID;
const pageTitleEl = document.getElementById('pageTitle');
if (pageTitleEl) {
  pageTitleEl.textContent = TEST_ID;
}

const META_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSwmXatD1TfDmC8mB6GBhN_KLZ4mh8NKV_QtuDNVf3dDYNwA2gLvtSVKzb-VRUaP9ILG_vKThvALITu/pub?output=csv";

function parseMetaCSV(text) {
  const lines = text.trim().split("\n");
  if (lines.length < 2) return [];
  const header = lines[0].split(",").map(h => h.trim());
  const rows = lines.slice(1);
  return rows.map(row => {
    const cols = row.split(",");
    const obj = {};
    header.forEach((h, i) => { obj[h] = (cols[i] || "").trim(); });
    return obj;
  });
}

async function loadTestTitle() {
  try {
    const resp = await fetch(META_CSV_URL);
    const text = await resp.text();
    const data = parseMetaCSV(text);
    const currentFile = location.pathname.split("/").pop();
    const meta = data.find(r =>
      (r.File || "").toLowerCase() === (currentFile || "").toLowerCase()
    );
    const h1 = document.getElementById("pageTitle");
    if (meta && meta.Title) {
      document.title = meta.Title;
      if (h1) h1.textContent = meta.Title;
    } else if (h1 && h1.textContent === "Đang tải tiêu đề...") {
      h1.textContent = "Practice Test";
    }
  } catch (err) {
    console.error("Không đọc được meta CSV:", err);
    const h1 = document.getElementById("pageTitle");
    if (h1 && h1.textContent === "Đang tải tiêu đề...") {
      h1.textContent = "Practice Test";
    }
  }
}

const LOG_ENDPOINT = 'https://script.google.com/macros/s/AKfycbwv8q--sVh5XrXUS7ZIHCK-VLltJesaT5NmV1cCw1tliN938Rm5iHgWAR_4MeJUmKMh/exec';

// ----- DỮ LIỆU ĐỀ -----
const RAW_DATA = `

1094	reading	17	1	short	[IMG:https://drive.google.com/file/d/1WxMEcafn-7nqyy4yGbrZJYeO31q6wpIz/view?usp=drive_link] // Điền từ trong khung vào chỗ trống và **viết lại cả câu**	1					Don't forget your umbrella; it looks like it's going to rain later today.
1095	reading	17	1	short		2					The temperature outside is very low. You should wear a warm jacket.
1096	reading	17	1	short		3					I love it when the sky is sunny and there are no clouds.
1097	reading	17	1	short		4					The weather was so unpredictable that we experienced a sudden thunderstorm.
1098	reading	17	1	short		5					During winter, the ground is often covered with a layer of snow.
1099	reading	17	1	short		6					Be careful while driving; the weather is quite foggy and visibility is low.
1100	reading	17	1	short		7					Today has little or no sunshine. This is a cloudy but rainless day.
1101	reading	17	1	short		8					When it's windy, you might need to hold onto your hat to keep it from blowing away.
1102	reading	17	2	short	https://drive.google.com/file/d/10_uj1sU9YpilBqAzVvVQ4WQM-GmaHI2v/view?usp=drive_link // [IMG:https://drive.google.com/file/d/1tbS6ibw0JzF_hqPwlUjyffAK-rSo-7kh/view?usp=drive_link] // Exercise 2. Nghe và điền vào chỗ trống	1					weather
1103	reading	17	2	short		2					hot
1104	reading	17	2	short		3					sun
1105	reading	17	2	short		4					warm
1106	reading	17	2	short		5					clothes
1107	reading	17	2	short		6					water
1108	reading	17	2	short		7					rainy
1109	reading	17	2	short		8					clouds
1110	reading	17	2	short		9					umbrella
1111	reading	17	2	short		10					cold
1112	reading	17	2	short		11					temperature
1113	reading	17	2	short		12					coat
1114	reading	17	2	short		13					gloves
1115	reading	17	2	short		14					scarf
1116	reading	17	2	short		15					windy
1117	reading	17	2	short		16					temperature
1118	reading	17	2	short		17					windy
1119	reading	17	2	short		18					feel
1120	reading	17	2	short		19					comfortable
1121	listening	17	3	short	https://drive.google.com/file/d/1HitR9jGL4wYYqTu3OabXIEXZ5YfVr0sg/view?usp=drive_link// Exercise 3. Dịch các câu sau sang Tiếng Anh. Sau đó nghe để kiểm tra.	1. Ngày mai, bầu trời sẽ đầy mây.					Tomorrow, the sky will be cloudy.
1122	listening	17	4	short	https://drive.google.com/file/d/1YwR6kclLm3F3f6uUjcMCoVsgAzBW3Trs/view?usp=drive_link	2. Đêm nay sẽ có giông bão.					There will be thunderstorms tonight.
1123	listening	17	5	short	https://drive.google.com/file/d/1cEIOZYWPuX2eaNiHqYo63qf0_emj1ykR/view?usp=drive_link	3. Thứ Năm, nhiệt độ sẽ khoảng 32 độ C. (32 degrees Celsius)					On Thursday, the temperature will be around 32 degrees Celsius.
1124	listening	17	6	short	https://drive.google.com/file/d/1v8c4c895m4oy7qXJVFWGpFquJh821Btf/view?usp=drive_link	4. Trời sẽ không lạnh và có tuyết.					It will not be cold and there will be snow.
1125	listening	17	7	short	https://drive.google.com/file/d/107oZtGbiINEJxyoYEyhOlwYq8RP95fa3/view?usp=drive_link	5. Việt Nam có khí hậu nhiệt đới. Thời tiết nóng và ẩm.					Vietnam has a tropical climate. The weather is hot and humid.
1126	listening	17	8	short	https://drive.google.com/file/d/1T_V29tC7zyRosf3WaJmHhbMTKBuJcqLW/view?usp=drive_link	6. Ở miền Bắc, có bốn mùa. Ở miền Nam, có hai mùa: mùa mưa và mùa khô.					In the North, there are four seasons. In the South, there are two seasons: the rainy season and the dry season.

`;

// ====== CODE CHUNG ======
let timerInterval = null;
let timeLeft = 0;

function startTimer(totalSeconds) {
  timeLeft = totalSeconds;
  const timerEl = document.getElementById('timer');
  if (timerInterval) clearInterval(timerInterval);

  function updateDisplay() {
    const minutes = Math.floor(timeLeft / 60);
    const seconds = timeLeft % 60;
    timerEl.textContent =
      String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');
  }
  updateDisplay();

  timerInterval = setInterval(() => {
    timeLeft--;
    if (timeLeft <= 0) {
      clearInterval(timerInterval);
      timeLeft = 0;
      updateDisplay();
      alert('Hết thời gian! Hệ thống sẽ tự chấm điểm.');
      gradeQuiz();
    } else {
      updateDisplay();
    }
  }, 1000);
}

function escapeHtml(str) {
  return str
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;');
}

function renderImgToken(urlRaw) {
  const url = urlRaw.trim();
  if (/drive\.google\.com/i.test(url)) {
    let id = '';
    const m1 = url.match(/\/d\/([^\/]+)/);
    const m2 = url.match(/[?&]id=([^&]+)/);
    if (m1 && m1[1]) id = m1[1];
    else if (m2 && m2[1]) id = m2[1];
    if (id) {
      const preview = 'https://drive.google.com/file/d/' + id + '/preview';
      return '<br><iframe class="img-frame" src="' + preview + '" allow="autoplay"></iframe>';
    }
  }
  return '<br><img class="q-img" src="' + url + '" alt="image">';
}

function parseSheet(rawText) {
  if (!rawText.trim()) return [];
  const lines = rawText.trim().split('\n').filter(l => l.trim() !== '');
  const questions = [];
  lines.forEach((line, index) => {
    const cols = line.split('\t');
    const q = {
      id: cols[0] || String(index + 1),
      skill: (cols[1] || '').toLowerCase(),
      part: cols[2] || '',
      group: cols[3] || ('G' + (index + 1)),
      type: (cols[4] || 'mcq').toLowerCase(),
      passage: cols[5] || '',
      question: cols[6] || '',
      options: [cols[7] || '', cols[8] || '', cols[9] || '', cols[10] || ''],
      answer: (cols[11] || '').trim()
    };
    questions.push(q);
  });
  return questions;
}

// Passage: text + media
function renderPassageWithMedia(passageText, containerEl, skill) {
  if (!passageText) return;
  const segments = passageText
    .split(' // ')
    .map(s => s.trim())
    .filter(Boolean);
  const textSegments = [];

  segments.forEach(seg => {
    if (/^\[IMG:/i.test(seg)) {
      textSegments.push(seg);
      return;
    }
    const isHttp      = /^https?:\/\//i.test(seg);
    const hasAudioExt = /\.(mp3|wav|m4a|ogg)(\?|$)/i.test(seg);
    const isDriveLink = /drive\.google\.com/i.test(seg);
    const isAudioUrl  = isHttp && hasAudioExt;

    if (isDriveLink || isAudioUrl) {
      if (isDriveLink) {
        let fileId = '';
        const m1 = seg.match(/\/d\/([^\/]+)/);
        const m2 = seg.match(/[?&]id=([^&]+)/);
        if (m1 && m1[1]) fileId = m1[1];
        else if (m2 && m2[1]) fileId = m2[1];
        if (fileId) {
          const iframe = document.createElement('iframe');
          iframe.className = 'audio-frame';
          iframe.src = 'https://drive.google.com/file/d/' + fileId + '/preview';
          iframe.allow = 'autoplay';
          containerEl.appendChild(iframe);
        }
      } else if (isAudioUrl) {
        const audio = document.createElement('audio');
        audio.controls = true;
        audio.src = seg;
        containerEl.appendChild(audio);
      }
    } else {
      textSegments.push(seg);
    }
  });

  if (textSegments.length) {
    const passageDiv = document.createElement('div');
    passageDiv.className = 'passage';
    let html = escapeHtml(textSegments.join(' // '));
    html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
    html = html.replace(/\/\/\s*/g, '<br><br>');
    html = html.replace(/\[IMG:([^\]]+)\]/gi, (m, url) => renderImgToken(url));
    passageDiv.innerHTML = html;
    containerEl.appendChild(passageDiv);
  }
}

function renderQuiz(questions) {
  const quizDiv = document.getElementById('quiz');
  quizDiv.innerHTML = '';
  const groups = {};
  const groupOrder = [];

  questions.forEach((q, idx) => {
    const key = (q.group && q.group.trim()) ? q.group.trim() : ('G' + q.id);
    if (!groups[key]) {
      groups[key] = { skill: q.skill, passage: q.passage, questions: [] };
      groupOrder.push(key);
    }
    groups[key].questions.push(q);
  });

  let questionCounter = 0;

  groupOrder.forEach(key => {
    const g = groups[key];
    const pTrim = (g.passage || '').trim();

    // READING: 2 cột
    if (g.skill === 'reading') {
      const layout = document.createElement('div');
      layout.className = 'reading-layout';

      const left = document.createElement('div');
      left.className = 'reading-left group-block';
      const title = document.createElement('h2');
      title.textContent = 'Reading ' + key;
      left.appendChild(title);
      if (pTrim) renderPassageWithMedia(pTrim, left, g.skill);

      const right = document.createElement('div');
      right.className = 'reading-right';

      g.questions.forEach(q => {
        questionCounter++;
        const qDiv = document.createElement('div');
        qDiv.className = 'question';
        qDiv.dataset.answer = (q.answer || '').trim();
        qDiv.dataset.type = q.type || 'short';

        const titleP = document.createElement('p');
        let qHtml = escapeHtml(q.question || '');
        qHtml = qHtml.replace(/\/\/\s*/g, '<br>');
        qHtml = qHtml.replace(/\[IMG:([^\]]+)\]/gi, (m, url) => renderImgToken(url));
        qHtml = qHtml.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
        titleP.innerHTML =
          '<span class="question-number">' + questionCounter + '.</span> ' + qHtml;
        qDiv.appendChild(titleP);

        if (q.type === 'mcq') {
          ['A','B','C','D'].forEach((labelOpt, i) => {
            if (!q.options[i]) return;
            const optLabel = document.createElement('label');
            const radio = document.createElement('input');
            radio.type = 'radio';
            radio.name = 'q' + questionCounter;
            radio.value = labelOpt;
            optLabel.appendChild(radio);
            optLabel.appendChild(
              document.createTextNode(' ' + labelOpt + '. ' + q.options[i])
            );
            qDiv.appendChild(optLabel);
            qDiv.appendChild(document.createElement('br'));
          });
        } else {
          const input = document.createElement('input');
          input.type = 'text';
          input.name = 'q' + questionCounter;
          input.className = 'short-answer-input';
          qDiv.appendChild(input);
        }

        right.appendChild(qDiv);
      });

      layout.appendChild(left);
      layout.appendChild(right);
      quizDiv.appendChild(layout);
    } else {
      // LISTENING & khác
      const groupDiv = document.createElement('div');
      groupDiv.className = 'group-block';
      const title = document.createElement('h2');
      title.textContent = (g.skill === 'listening' ? 'Listening ' : 'Section ') + key;
      groupDiv.appendChild(title);
      if (pTrim) renderPassageWithMedia(pTrim, groupDiv, g.skill);

      g.questions.forEach(q => {
        questionCounter++;
        const qDiv = document.createElement('div');
        qDiv.className = 'question';
        qDiv.dataset.answer = (q.answer || '').trim();
        qDiv.dataset.type = q.type || 'short';

        const titleP = document.createElement('p');
        let qHtml = escapeHtml(q.question || '');
        qHtml = qHtml.replace(/\/\/\s*/g, '<br>');
        qHtml = qHtml.replace(/\[IMG:([^\]]+)\]/gi, (m, url) => renderImgToken(url));
        qHtml = qHtml.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
        titleP.innerHTML =
          '<span class="question-number">' + questionCounter + '.</span> ' + qHtml;
        qDiv.appendChild(titleP);

        if (q.type === 'mcq') {
          ['A','B','C','D'].forEach((labelOpt, i) => {
            if (!q.options[i]) return;
            const optLabel = document.createElement('label');
            const radio = document.createElement('input');
            radio.type = 'radio';
            radio.name = 'q' + questionCounter;
            radio.value = labelOpt;
            optLabel.appendChild(radio);
            optLabel.appendChild(
              document.createTextNode(' ' + labelOpt + '. ' + q.options[i])
            );
            qDiv.appendChild(optLabel);
            qDiv.appendChild(document.createElement('br'));
          });
        } else {
          const input = document.createElement('input');
          input.type = 'text';
          input.name = 'q' + questionCounter;
          input.className = 'short-answer-input';
          qDiv.appendChild(input);
        }

        groupDiv.appendChild(qDiv);
      });

      quizDiv.appendChild(groupDiv);
    }
  });
}

function normalizeText(str) {
  return (str || '')
    .toLowerCase()
    .replace(/[\u2018\u2019]/g, "'")          // ‘ ’ -> '
    .replace(/[\u00A0\u200B-\u200D\uFEFF]/g, ' ') // xoá khoảng trắng & ký tự ẩn
    .replace(/\s+/g, ' ')                    // gộp nhiều khoảng trắng
    .trim();
}

function gradeQuiz() {
  const quizDiv = document.getElementById('quiz');
  const questionDivs = quizDiv.querySelectorAll('.question');
  let correct = 0;
  const total = questionDivs.length;

  questionDivs.forEach(div => {
    const type = div.dataset.type || 'short';
    const answerRawDisplay = (div.dataset.answer || '').trim();
    const answerList = answerRawDisplay
      .split('|')
      .map(normalizeText)
      .filter(s => s);

    let userAnswer = '';
    if (type === 'mcq') {
      const checked = div.querySelector('input[type="radio"]:checked');
      if (checked) userAnswer = normalizeText(checked.value);
    } else {
      const input = div.querySelector('input[type="text"]');
      if (input) userAnswer = normalizeText(input.value);
    }

    let isCorrect = false;
    if (answerList.length && userAnswer) {
      if (answerList.includes(userAnswer)) isCorrect = true;
    }

    if (isCorrect) {
      div.classList.add('correct');
      div.classList.remove('incorrect');
      correct++;
    } else {
      div.classList.add('incorrect');
      div.classList.remove('correct');
    }
  });

  const percent = Math.round(correct * 100 / Math.max(total, 1));
  const name = (document.getElementById('studentName').value || '').trim() || 'NoName';
  const cls  = (document.getElementById('studentClass').value || '').trim();
  const now  = new Date();
  const timestamp = now.toLocaleString();

  const logLine =
    name + '\t' + cls + '\t' + TEST_ID + '\t' +
    timestamp + '\t' + correct + '\t' + total + '\t' + percent;

  if (LOG_ENDPOINT) {
    const payload = {
      testId:   TEST_ID,
      name:     name,
      className: cls,
      correct:  correct,
      total:    total,
      percent:  percent,
      rawLog:   logLine
    };
    fetch(LOG_ENDPOINT, {
      method: 'POST',
      mode: 'no-cors',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    }).catch(err => console.error('Error sending result to Sheet:', err));
  }

  const box = document.getElementById('resultBox');
  box.style.display = 'block';
  box.innerHTML = `
  <div style="font-size:16px; margin-bottom:4px;">
    <strong>Bài test:</strong> ${TEST_ID}
  </div>
  <div style="font-size:18px; margin-bottom:8px;">
    <strong>Kết quả:</strong> đúng ${correct}/${total} câu
  </div>
  <div style="
    font-size:28px;
    font-weight:bold;
    color:#007acc;
    padding:10px 0;
  ">
    ${percent}%
  </div>
  `;
}

// Bắt buộc nhập Họ tên & Lớp/Nhóm trước khi nộp
document.getElementById('submitBtn').addEventListener('click', () => {
  const nameInput = document.getElementById('studentName');
  const classInput = document.getElementById('studentClass');
  const name = (nameInput.value || '').trim();
  const cls  = (classInput.value || '').trim();
  if (!name || !cls) {
    alert('Vui lòng nhập đầy đủ HỌ TÊN và LỚP / NHÓM trước khi nộp bài.');
    if (!name) nameInput.focus();
    else if (!cls) classInput.focus();
    return;
  }
  gradeQuiz();
});

document.getElementById('retryBtn').addEventListener('click', () => {
  location.reload();
});

// Khởi động
(function initExam() {
  const qs = parseSheet(RAW_DATA);
  if (!qs.length) {
    document.getElementById('quiz').innerHTML =
      '<p style="color:red;">Giáo viên chưa dán dữ liệu đề vào biến RAW_DATA.</p>';
    return;
  }
  renderQuiz(qs);
  startTimer(DURATION_MINUTES * 60);
})();

loadTestTitle();
</script>

<footer class="footer">
  <p>© <span id="year"></span> Online Practice by Dung Phạm. All rights reserved.</p>
</footer>

<script>
document.getElementById("year").textContent = new Date().getFullYear();
</script>

</body>
</html>
